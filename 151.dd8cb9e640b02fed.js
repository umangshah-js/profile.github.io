(()=>{let p=0,A=0,F=0,$=null,_=null,w=null,y=null,m=null,D=!1;const k=t=>$&&($[t]||$[" "])||[[0]],N=t=>Array.isArray(t.text)||"string"==typeof t.text?t.text:[],W=t=>" "!=t&&":"!=t&&"/"!=t&&"."!=t,B=(t,e)=>{let r=k(t)[0].length*e;return W(t)&&(r+=2),r},S=(t,e)=>{let n=0;for(const r of t)n+=B(r,e);return n},H=t=>null!=t?.colorSlot?t.colorSlot:Array.isArray(t?.text)&&t.text.some(e=>"box"==e||"box_solid"==e)?5:"logo"==t?.type?2:(t?.scaleFactor||1)>=3?1:2==(t?.scaleFactor||1)?2:3,V=t=>({github:22,linkdin:23,email:24,"resume-download":25,flutter:10,redis:11,git:12,spark:13,angular:14,postgres:15,python:16,java:17,javascript:18,docker0:19,docker1:19,docker2:19,docker3:19,docker4:19,linux:20,windows:21}[t]||2),z=(t,e,n,r,l="- ",o="  ")=>{const s=S(l,e)-S(o,e),u=t.trim().split(/\s+/).filter(Boolean);if(0==u.length)return[{text:l,xOffset:0}];const g=[];let h=l,f=h;for(const x of u){const i=f.trim()==h.trim()?`${f}${x}`:`${f} ${x}`;S(i,e)<=n||f.trim()==h.trim()?f=i:(g.push({text:f,xOffset:h==l?0:s}),h=o,f=`${h}${x}`)}if(g.push({text:f,xOffset:h==l?0:s}),null!=r&&r>0&&g.length>r){const x=g.slice(0,r),i="...";let d=x[r-1].text.replace(/\s+$/,"");for(;d.length>0&&S(`${d}${i}`,e)>n;)d=d.slice(0,-1).replace(/\s+$/,"");return x[r-1].text=`${d}${i}`,x}return g},j=(t,e,n)=>{const r=[];for(let l=0;l<t.length;l++){const o=t[l];if("string"!=typeof o.text||!/^\s*-\s+/.test(o.text)){r.push(o);continue}const c=o.text.match(/^(\s*)-\s+/),a=c?c[1]:"",s=`${a}- `;let u=a;const g=S(s,o.scaleFactor);for(;S(u,o.scaleFactor)<g;)u+=" ";let h=o.text.replace(/^\s*-\s+/,"").trim(),f=l+1;for(;f<t.length;){const i=t[f];if("string"!=typeof i.text||i.scaleFactor!=o.scaleFactor)break;const d=i.text.trim();if(""==d||/^\s*-\s+/.test(i.text))break;h+=` ${d}`,f+=1}const x=z(h,o.scaleFactor,e,n,s,u);for(const i of x)r.push({text:i.text,scaleFactor:o.scaleFactor,xOffset:i.xOffset});l=f-1}return r},E=t=>{const e=t.map(l=>l.findIndex(o=>(t=>Array.isArray(t?.text)&&t.text.some(e=>"box"==e||"box_solid"==e))(o))),n=e.filter(l=>l>=0);if(0==n.length)return t;const r=Math.max(...n);return t.map((l,o)=>{const c=e[o];if(c<0||c>=r)return l;const a=[...l],s=r-c;for(let u=0;u<s;u++)a.splice(c,0,{text:" ",scaleFactor:1});return a})},L=t=>t.rotate?t._renderSlides[t.curr]:t._renderLines,q=(t,e,n,r,l,o,c)=>{let a=n;for(const s of e){const u=H(s),g=N(s),f=k(g[0]||" "),x=s.scaleFactor*f.length;let i=r+(s?.xOffset||0);for(const d of g){if(c<(o+=1)/l){i+=k(d)[0].length*s.scaleFactor,W(d)&&(i+=2);continue}const M=k(d),Q="logo"==s?.type?V(d):u;for(let b=0;b<M.length;b++)for(let O=0;O<s.scaleFactor;O++){const U=b*s.scaleFactor+a+O;if(!(U<0||U>=A))for(let v=0;v<M[b].length;v++)for(let I=0;I<s.scaleFactor;I++){const C=v*s.scaleFactor+i+I;C<0||C>=p||(t[U*p+C]=M[b][v]?Q:0)}}i+=M[0].length*s.scaleFactor,W(d)&&(i+=2)}a+=x}return o},K=()=>{const t={};for(const e in _){const n=_[e];n.rotate&&(t[e]={curr:n.curr,updated:n.updated})}return t};addEventListener("message",({data:t})=>{if("init"==t?.type)return p=t.gridWidth,A=t.gridHeight,F=p*A,$=t.charMap,_=t.content,w=new Uint8Array(F),y=new Uint8Array(F),m=new Uint8Array(F),(()=>{for(const t in _){const e=_[t],n=e.bulletWrapWidth,r=e.bulletWrapMaxLines;if(e.rotate){const l=e.lines.map(o=>null==n?o:j(o,n,r));e._renderSlides=E(l),null==e.curr&&(e.curr=0),null==e.updated&&(e.updated=Date.now())}else e._renderLines=null==n?e.lines:j(e.lines,n,r)}})(),D=!0,void postMessage({type:"init-ack"});if(!D||"frame"!=t?.type||!t.buffer)return;const e=new Uint8Array(t.buffer);t.gameon?(t=>{(!w||w.length!=t.length)&&(w=new Uint8Array(t.length)),(!y||y.length!=t.length)&&(y=new Uint8Array(t.length)),(!m||m.length!=t.length)&&(m=new Uint8Array(t.length)),w.fill(0),y.fill(0),m.fill(0);for(let e=1;e<A-1;e++)for(let n=1;n<p-1;n++){const r=e*p+n;let l=0,o=2;const c=h=>{const f=31&t[h];f>0&&(l+=1,2==o&&(o=f))};c((e-1)*p+(n-1)),c((e-1)*p+n),c((e-1)*p+(n+1)),c(e*p+(n-1)),c(e*p+(n+1)),c((e+1)*p+(n-1)),c((e+1)*p+n),c((e+1)*p+(n+1));const a=t[r],s=31&a,u=a>>5&7,g=s>0;!g||2!=l&&3!=l?!g&&3==l&&(w[r]=1,y[r]=o,m[r]=1):(w[r]=1,y[r]=s,m[r]=Math.min(u+1,7))}for(let e=0;e<t.length;e++)t[e]=0!=w[e]?m[e]<<5|31&y[e]:0})(e):((t,e)=>{t.fill(0),(t=>{for(const e in _){const n=_[e];n.rotate&&n.updated+n.timeout<=t&&(n.curr=(n.curr+1)%n._renderSlides.length,n.updated=t)}})(Date.now());let r=0;for(const o in _){const c=L(_[o]);for(const a of c)r+="logo"==a.type?1:N(a).length}if(0==r)return;let l=0;for(const o in _){const c=_[o],a=c.padding_top,s=c.padding_left,u=L(c);l=q(t,u,a,s,r,l,e)}})(e,t.loadPr??1),postMessage({type:"frame",buffer:e.buffer,contentState:K()},[e.buffer])})})();